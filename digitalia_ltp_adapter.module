<?php

use Drupal\Core\Entity\EntityInterface;
use Drupal\digitalia_ltp_adapter\DigitaliaLtpUtils;
use Drupal\node\Entity\Node;


/**
 * implements hook_entity_presave()
 */
function digitalia_ltp_adapter_entity_presave(EntityInterface $entity)
{
	dpm("Entity presave hook");
	\Drupal::logger('digitalia_ltp_adapter')->debug("Entity presave hook");

	$utils = new DigitaliaLtpUtils();

	if (!$utils->getConfig()->get('auto_generate_switch')) {
		return;
	}


	if ($utils->getEnabledContentTypes()[$entity->bundle()]) {

		if (!$entity->get("status")->first()->getValue()['value']) {
			dpm("Entity IS NOT published");
			\Drupal::logger('digitalia_ltp_adapter')->debug("Entity '" . $entity->getTitle() . "'is not published");
			return;
		}


		$utils->archiveData($entity, $utils::Single);
	}
}

/**
 * implements hook_entity_predelete()
 */
function digitalia_ltp_adapter_entity_predelete(EntityInterface $entity)
{
	dpm("Entity predelete hook");
}
