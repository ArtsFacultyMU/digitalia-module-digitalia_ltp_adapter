<?php

use Drupal\Core\Entity\EntityInterface;
use Drupal\digitalia_ltp_adapter\DigitaliaLtpUtils;
use Drupal\node\Entity\Node;


/**
 * implements hook_entity_presave()
 */
function digitalia_ltp_adapter_entity_presave(EntityInterface $entity)
{
	dpm("Entity presave hook");
	\Drupal::logger('digitalia_ltp_adapter')->debug("Entity presave hook");
	\Drupal::logger('digitalia_ltp_adapter')->debug("Bundle: " . $entity->bundle());

	$utils = new DigitaliaLtpUtils();

	if (!$utils->getConfig()->get('auto_generate_switch')) {
		return;
	}


	if ($utils->getEnabledContentTypes()[$entity->bundle()]) {

		$status = $entity->get("status");
		$published = false;

		// Untranslated entities store bool, translated entities are more complex
		if (is_bool($status)) {
			$published = $status;
		} else {
			$published = $status->getValue()[0]['value'];
		}

		if ($published) {
			$utils->archiveData($entity, $utils::Single);
		}
	}
}

/**
 * implements hook_entity_predelete()
 */
function digitalia_ltp_adapter_entity_predelete(EntityInterface $entity)
{
	dpm("Entity predelete hook");
}
